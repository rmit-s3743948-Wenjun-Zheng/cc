<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>Popular</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/dashboard/">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/toastr.min.css') }}" />

    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/toastr.min.js') }}"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">Company name</a>
  <ul class="navbar-nav px-3">
    <button type="button" class="btn btn-sm btn-outline-light" onclick="Logout()">
      <span>

      </span>
       Sign out
    </button>
  </ul>
</nav>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="sidebar-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="/user">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
              </span>
              User
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/email">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
              </span>
              Regist Email
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/foodlist">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
              </span>
              Food List
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/add">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-square"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
              </span>
              Add Food
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/popular">
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
              </span>
              Popular Food<span class="sr-only">(current)</span>
            </a>
          </li>
        </ul>

      </div>
    </nav>

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="display-4">Top ten most popular health foods </h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group mr-2">
            <button type="button" class="btn btn-outline-secondary" onclick="compute()">Compute Popular Food</button>
            <button type="button" class="btn btn-outline-secondary" onclick="getpopular1()">Show Popular Food</button>
          </div>
        </div>
      </div>

      <canvas class="my-4 w-100" id="myChart" width="900" height="380" ></canvas>

    </main>
  </div>
</div>
<script>

  labels = []
  datalist = []
  data = {}
  $(document).ready(function(){
    $.ajax({
          url: "/getpopular",
          type: "POST",
          contentType: "application/json",
          success: function(checkresult){
            if(checkresult.status == "ok"){
              for(var i=0;i<checkresult.list.length;i++){
                labels.push(checkresult.list[i][0])
                datalist.push(checkresult.list[i][1])
              }
            }
            else if (checkresult.status == "error"){
              toastr.error("The EMR job is not finish，please wait.")
            }
          }
     })
  })

  data = {
         "labels": labels,
         "datasets": [{
           "label": "Popluar Health Food",
           "data": datalist,
           "fill": false,
           "backgroundColor": [
             "rgba(255, 99, 132, 0.2)", 
             "rgba(255, 159, 64, 0.2)",
             "rgba(255, 205, 86, 0.2)", 
             "rgba(75, 192, 192, 0.2)", 
             "rgba(54, 162, 235, 0.2)",
             "rgba(153, 102, 255, 0.2)", 
             "rgba(201, 203, 207, 0.2)"
            ],
            "borderColor": [
              "rgb(255, 99, 132)", 
              "rgb(255, 159, 64)", 
              "rgb(255, 205, 86)",
              "rgb(75, 192, 192)", 
              "rgb(54, 162, 235)", 
              "rgb(153, 102, 255)", 
              "rgb(201, 203, 207)"
            ],
            "borderWidth": 1
          }]
        }

  const config = {
    type: 'bar',
    data: data,
    options: {
      y: {
        beginAtZero: true
      }
    }
  }

  var mychart = new Chart(
      document.getElementById("myChart"),
      config
    )

  function Logout(){
        $.ajax({
          url: "/user",
          type: "POST",
          contentType: "application/json",
          success: function(checkresult){
            next(checkresult.next)
          }
        })
        
        function next(url){
          window.location.href = url
        }
    }

  function compute(){
    $.ajax({
      url: "/compute",
      type: "POST",
      dataType: "json",
      contentType: "application/json",
      success: function(checkresult){
        if(checkresult.status == "ok"){
          toastr.info("Success to recrive compute request, please wait EMR to finish mapreduce job and see the result")
        }
        else if (checkresult.status == "failed"){
          toastr.error("you do not have authority to execute compute operation, only admin can do this")
        }
        else if (checkresult.status == "failed"){
          toastr.error("You must register a email first")
        }
      }
    })
  }

  function getpopular1(){
    labels = [];
    data = []
    $.ajax({
          url: "/getpopular",
          type: "POST",
          contentType: "application/json",
          success: function(checkresult){
            if(checkresult.status == "ok"){
              for(var i=0;i<checkresult.list.length;i++){
                labels.push(checkresult.list[i][0])
                datalist.push(checkresult.list[i][1])
              }
            }
            else if (checkresult.status == "error"){
              toastr.error("The EMR job is not finish，please wait.")
            }
          }
     })
  }
</script>

</html>